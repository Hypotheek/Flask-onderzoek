<!doctype html>
<title>Log In - Flaskr</title>
<link rel="stylesheet" href="style.css">
<script src="layout.js"></script>

<section class="content">
  <header>
    <h1>Log In</h1>
  </header>

  <form id="loginForm">
    <label for="username">Username</label>
    <input name="username" id="username" required>
    <label for="password">Password</label>
    <input type="password" name="password" id="password" required>
    <input type="submit" value="Log In">
  </form>
</section>

<script>
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = {
            username: document.getElementById('username').value,
            password: document.getElementById('password').value
        };

        const res = await fetch('/auth/login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(formData)
        });
        
        const data = await res.json();
        if (res.ok) {
            // Save user info for the UI
            localStorage.setItem('user', JSON.stringify({
                id: data.user_id, 
                username: formData.username // or data.username if returned
            }));
            window.location.href = '/';
        } else {
            window.flash(data.error);
        }
    });
</script>