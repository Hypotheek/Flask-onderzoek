<!doctype html>
<title>New Post - Flaskr</title>
<link rel="stylesheet" href="style.css">
<script src="layout.js"></script>

<section class="content">
  <header>
    <h1>New Post</h1>
  </header>

  <form id="createForm">
    <label for="title">Title</label>
    <input name="title" id="title" required>
    <label for="body">Body</label>
    <textarea name="body" id="body"></textarea>
    <input type="submit" value="Save">
  </form>
</section>

<script>
    if (!localStorage.getItem('user')) window.location.href = '/login';

    document.getElementById('createForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = {
            title: document.getElementById('title').value,
            body: document.getElementById('body').value
        };

        const res = await fetch('/blog/create', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(formData)
        });

        if (res.ok) {
            window.location.href = '/';
        } else {
            const data = await res.json();
            window.flash(data.error || 'Error creating post');
        }
    });
</script>